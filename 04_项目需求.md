# ④ 项目需求（功能为主）

## 1. 背景与目标
- 为风控场景提供标准化的违约认定/重生管理工具，覆盖申请、审批、查询、统计与审计。

## 2. 角色与权限（RBAC）
- Admin：用户与配置管理，拥有全权限
- Reviewer：审批权限 + 查询
- Operator：发起申请 + 查询

## 3. 功能需求
### 3.1 认证与用户
- 登录：/auth/token（JWT）
- 我的信息：/users/me
- 用户管理（Admin）：/users CRUD，邮箱唯一、幂等创建

### 3.2 客户主数据
- 字段：name、industry、region、is_default
- 操作：新增/查/改/删

### 3.3 原因维护
- 类型：DEFAULT（违约）、REBIRTH（重生）
- 字段：description、enabled、sort_order
- 仅 Admin 可维护；仅 enabled 可用于申请

### 3.4 申请与审批
- 创建申请：type=DEFAULT|REBIRTH，需 customer_id、reason_id
- 业务规则：
  - 已违约客户不可再次 DEFAULT；非违约客户不可 REBIRTH
  - 审批 DEFAULT=APPROVED 前需至少1个附件
- 审批：/applications/{id}/review，APPROVED/REJECTED
- 通过后：同步 customers.is_default（DEFAULT->True, REBIRTH->False）

### 3.5 附件与存储
- 上传：/applications/{id}/attachments（multipart）
- 预签名/直链：/applications/{id}/attachments/presign
- 后端支持 local 与 S3；local 直出 /files/ 路径

### 3.6 统计
- 行业/区域：/stats/industry、/stats/region，按年度汇总
- detailed=true：返回各类别占比与近12个月趋势数组

### 3.7 审计
- 中间件记录：actor、action（中文）、resource、ip、timestamp
- 查询：/audit-logs/（Admin），支持过滤、limit

### 3.8 通知
- 审批后向申请人发送站内通知；支持标记已读

### 3.9 前端功能
- 登录与权限路由、菜单过滤
- 页面：客户、原因、申请、统计、审计（Admin）、用户（Admin）

## 4. 非功能（简要）
- 安全：JWT、RBAC、最小权限；禁止越权访问
- 可用性：Swagger 文档；前端直观导航
- 可运维：.env 配置；Alembic 迁移；Docker Compose

## 5. 验收标准（摘）
- 业务规则正确执行（DEFAULT 需附件、状态联动）
- 审计字段完整（中文 action、actor/resource/ip）
- 统计 detailed 返回占比与12月趋势
- 管理员可完整管理用户
